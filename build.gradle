plugins {
    id "com.gradleup.shadow" version "${shadow_version}" apply false
    id "net.neoforged.moddev" version "${moddev_version}" apply false
}

allprojects {
    repositories {
        mavenCentral()
    }
}

subprojects {
    apply plugin: "java"

    version = mod_version

    java.toolchain.languageVersion = JavaLanguageVersion.of(21)

    java {
        sourceCompatibility = JavaVersion.VERSION_21
        targetCompatibility = JavaVersion.VERSION_21
    }

    tasks.withType(JavaCompile).configureEach {
        options.release = 21
        options.encoding = "UTF-8"
    }

    processResources {
        def propertiesToExpand = new HashMap<String, Object>(project.properties)
        filesMatching(["**/*.txt", "**/*.yml", "**/*.toml"]) {
            expand(propertiesToExpand)
        }
    }

    configurations.configureEach {
        resolutionStrategy {
            force "org.slf4j:slf4j-api:${slf4j_api_version}"
            force "com.fasterxml.jackson.core:jackson-core:${jackson_core_version}"
            force "com.fasterxml.jackson.core:jackson-databind:${jackson_databind_version}"
            force "com.fasterxml.jackson.core:jackson-annotations:${jackson_annotations_version}"
        }
    }
}

project.afterEvaluate {
    delete file("build")
}
